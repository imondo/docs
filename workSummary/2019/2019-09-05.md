# xss 漏洞

前端做转义

```js
dataEncodeOut = function(data) {

  return function encodeOut() {
    var rel = data;
    var source = '';
    if (typeof rel == 'object') {
      source = htmlEncodeOut(JSON.stringify(rel));
      source = JSON.parse(source);
      rel = source;
    } else if (typeof rel == 'string') {
      source = htmlEncodeOut(rel);
      rel = source;
    }
    return rel;
  }

  function htmlEncode(str) {
    var s = '';
    if (str.length == 0) return '';
    //s = str.replace(/ /g, "&nbsp;");
    //s = str.replace(/&/g, "&amp;");
    s = str.replace(/</g, '%26lt%3B');
    s = s.replace(/%3C/g, '%26lt%3B');
    s = s.replace(/%3c/g, '%26lt%3B');
    s = s.replace(/>/g, '%26gt%3B');
    s = s.replace(/%3E/g, '%26gt%3B');
    s = s.replace(/%3e/g, '%26gt%3B');
    //s = s.replace(/\'/g, "&#39;");
    //s = s.replace(/\"/g, "&quot;");
    //s = s.replace(/\n/g, "<br>");
    return s;
  }
  function htmlEncodeOut(str) {
    var s = '';
    if (str.length == 0) return '';
    //s = str.replace(/ /g, "&nbsp;");
    //s = str.replace(/&/g, "&amp;");
    s = str.replace(/</g, '&lt;');
    s = s.replace(/%3C/g, '&lt;');
    s = s.replace(/%3c/g, '&lt;');
    s = s.replace(/>/g, '&gt;');
    s = s.replace(/%3E/g, '&gt;');
    s = s.replace(/%3e/g, '&gt;');
    s = s.replace(/%26lt%3B/g, '&lt;');
    s = s.replace(/%26lt%3b/g, '&lt;');
    s = s.replace(/%26gt%3B/g, '&gt;');
    s = s.replace(/%26gt%3b/g, '&gt;');
    //s = s.replace(/\'/g, "&#39;");
    //s = s.replace(/\"/g, "&quot;");
    //s = s.replace(/\n/g, "<br>");
    return s;
  }
  function dataEncode(data) {
    var rel = data;
    var source = '';
    if (typeof rel == 'object') {
      source = htmlEncode(JSON.stringify(rel));
      source = JSON.parse(source);
      rel = source;
    } else if (typeof rel == 'string') {
      source = htmlEncode(rel);
      rel = source;
    }
    return rel;
  }
}
```