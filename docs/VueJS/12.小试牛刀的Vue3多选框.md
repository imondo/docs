# å°è¯•ç‰›åˆ€çš„Vue3å¤šé€‰æ¡†

> æºç ï¼š[åœ°å€](https://github.com/one-pupil/vue-components)

ç”±äºè‡ªå·±æœ€è¿‘ä¸€ç›´åœ¨ä½¿ç”¨ `Vue3`ï¼Œæœ¬ç€å­¦äº†ä¸ç”¨å°±ä½œåºŸçš„åŸåˆ™å°±è‡ªå·±å°è¯•ç€å†™äº† UI ç»„ä»¶ç¤ºä¾‹ã€‚è€Œåˆšå¼€å§‹é€‰æ‹©çš„å°±æ˜¯[å¤šé€‰æ¡†](https://github.com/one-pupil/vue-components/blob/main/src/libs/ainui/components/Checkbox/index.vue)è¿™ä¸ªç»„ä»¶ã€‚
å¤šé€‰æ¡† `Checkbox` ç»„ä»¶æ˜¯å¹³æ—¶ä½¿ç”¨é¢‘ç‡è›®é«˜çš„ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬ç°åœ¨ä¸€æ­¥æ­¥æ¥å®Œå–„è‡ªå·±çš„ç»„ä»¶ã€‚
## å¼€å§‹
å…ˆå®šä¹‰ç»„ä»¶
```vue
 <ani-checkbox>é€‰é¡¹</ani-checkbox>
```
åˆ›å»ºç»„ä»¶ `Checkbox.vue` æ–‡ä»¶
```vue
<template>
  <label
    class="checkbox-wrap"
  >
    <input
      type="checkbox"
      v-model="model"
    />
    <i class="check-icon">âœ“</i>
    <slot></slot>
  </label>
</template>
```
å¯¹ `Checkbox` è¿›è¡Œç¾åŒ–ï¼Œä¸»è¦å…ˆéšè— `input[type=checkbox]` å†å¯¹ `input[type=checkbox]:checked` é€‰æ‹©å™¨è¿›è¡Œå¤„ç†
```less
<style lang="less" scoped>
@color: #333;
@activeColor: #409eff;
.checkbox-wrap {
  margin-right: 15px;
  font-size: 14px;
  user-select: none;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
  .check-icon {
    margin-right: 5px;
    font-size: 14px;
    font-style: normal;
    display: inline-block;
    width: 14px;
    height: 14px;
    text-align: center;
    line-height: 14px;
    color: #fff;
    border: 1px solid @color;
    transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
  }
  input[type='checkbox'] {
    display: none;
  }
  input[type='checkbox']:checked + .check-icon {
    background-color: @activeColor;
    border-color: @activeColor;
  }
  &.is-checked-text {
    color: @activeColor;
  }
}
</style>
```
æ•ˆæœå¦‚ä¸‹
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d6061506d4941f6bc5699fdaf64be9a~tplv-k3u1fbpfcp-zoom-1.image)
## é€»è¾‘å¤„ç†
å…ˆå®šä¹‰ `props`
```vue
<ani-checkbox v-model="checked" @change="onChange">é€‰é¡¹</ani-checkbox>
```
æˆ‘ä»¬çŸ¥é“ `Vue3` å¯¹äº `v-model` çš„å¤„ç†å’Œä»¥å‰ç¨ç¨æœ‰ç‚¹ä¸åŒã€‚
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d57864247514ba8a546e3f86bd0788f~tplv-k3u1fbpfcp-zoom-1.image)
ç”±æ–‡æ¡£æ‰€è¿°ï¼Œå…¶ä¸­çš„ `prop` çš„ `value` å˜æˆäº† `modelValue`ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»„ä»¶å†…å®šä¹‰çš„ `props` éœ€è¦æ”¹å˜
```vue
props: {
  modelValue: {
    type: [Boolean, Number, String],
    default: () => undefined
  }
}
```
æˆ‘ä»¬åˆ©ç”¨ `computed` å®ç°åŒå‘ç»‘å®š
```javascript
  setup(props, { emit }) {
    const model = computed({
      get() {
        return props.modelValue;
      },
      set(val) {
        emit("update:modelValue", val);
      },
    });

    return {
      model
    }
  }
```
å†æ·»åŠ äº‹ä»¶å›è°ƒ
```vue
<input type="checkbox" v-model="model" @change="onChange"/>
```
è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ`emit` äº‹ä»¶æ—¶éœ€è¦åœ¨ `emits` ä¸­æ³¨å†Œ
```javascript
  emits: ['change'],
  setup(props, { emit }) {
		...
    const onChange = () => {
      emit('change', model.value);
    }

    return {
      onChange
    }
  },
```
ç”±æ­¤ï¼Œä¸€ä¸ªç®€å•çš„ `checkbox` ç»„ä»¶å°±å®Œæˆäº†ã€‚ä¸è¿‡æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„ `composition-api` å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸‹æ•´ä¸ªé€»è¾‘ `useCheckbox` å‡½æ•°
```javascript
import { getCurrentInstance } from 'vue';
export function useCheckbox(props) {
  const { proxy } = getCurrentInstance()
  const model = computed({
    get() {
      return props.modelValue;
    },
    set(val) {
      proxy.emit("update:modelValue", val);
    },
  });

  const onChange = () => {
    proxy.emit('change', model.value);
  }

  return {
    model,
    onChange
  }
}
```
å†åœ¨ç»„ä»¶ä¸­å¼•å…¥
```javascript
import { useCheckbox } from './useCheckbox';

setup(props) {
  return useCheckbox(props);
}
```
## å¤šé€‰æ¡†ç»„
æˆ‘ä»¬ä½¿ç”¨äº†å¾ˆå¤š UI åº“ç»„ä»¶ï¼Œ`checkbox` å­˜åœ¨å¤šé€‰ï¼Œå¤§å¤šæ•°ç»„ä»¶åº“ä¹Ÿæœ‰è¿™ä¸ªå¤šé€‰ç»„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°è£…ä¸€ä¸ªå¤šé€‰æ¡†ç»„ã€‚
æ–°å»ºä¸€ä¸ª `checkbox-group.vue` æ–‡ä»¶
```vue
<template>
  <div class="ani-checkbox-group">
    <slot></slot>
  </div>
</template>
```
è€Œå®é™…ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬åˆ©ç”¨ `checkbox-group` åŒ…è£¹ `checkbox` ç»„ä»¶
```vue
<ani-checkbox-group v-model="checkList">
  <ani-checkbox>é€‰é¡¹ä¸€</ani-checkbox>
  <ani-checkbox>é€‰é¡¹äºŒ</ani-checkbox>
  <ani-checkbox>é€‰é¡¹ä¸‰</ani-checkbox>
</ani-checkbox-group>
```
æ¨¡æ¿æ–‡ä»¶æˆ‘ä»¬å·²ç»å†™å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®Œå–„é€»è¾‘ï¼›è¿™é‡Œåˆ©ç”¨ `provide/inject` æ¥ä¼ é€’çˆ¶ç»„ä»¶å‚æ•°
```javascript
export default {
  name: 'AniCheckboxGroup',
  props: {
    modelValue: {
      type: [Array],
      default: () => undefined
    }
  },
  emits: ['change'],
  setup(props, ctx) {
    // å®šä¹‰äº‹ä»¶
    const changeEvent = value => {
      ctx.emit('update:modelValue', value);
      nextTick(() => {
        ctx.emit('change, value);
      });
    };
		
    const modelValue = computed({
      get() {
        return props.modelValue;
      },
      set(val) {
        changeEvent(val);
      }
    });
	
    // å‘å­ç»„ä»¶ä¼ é€’
    provide('CheckboxGroup', {
      name: 'CheckboxGroup',
      modelValue,
      ...toRefs(props),
      changeEvent
    });
  }
}
```
å­ç»„ä»¶ä¸­ `inject` æ¥æ”¶
```javascript
// æ¥æ”¶çˆ¶ç»„ä»¶æ¶ˆæ¯
export const useCheckboxGroup = () => {
  // è¿™é‡Œçš„åç§°å¯¹åº” provide åç§°
  const checkboxGroup = inject('CheckboxGroup', {});
  // åˆ¤æ–­æ˜¯å¦ä¸ºå¤šé€‰æ¡†ç»„
  const isGroup = computed(
    () => checkboxGroup && checkboxGroup.name === 'CheckboxGroup'
  );

  return {
    isGroup,
    checkboxGroup
  };
};
```
`useCheckbox` ä¸­éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºå¤šé€‰æ¡†ç»„ï¼Œå…·ä½“æ€è·¯çœ‹æ³¨é‡Šå§ğŸ¤£ï¼Œå…¶å®é€»è¾‘ä¹Ÿç®€å•~
```javascript
export const useCheckbox = props => {
  const { emit } = getCurrentInstance();

  const { isGroup, checkboxGroup } = useCheckboxGroup();

  // å­˜åœ¨å¤šé€‰ç»„ï¼Œåˆ™ä½¿ç”¨å¤šé€‰ç»„ modelValue
  const store = computed(() =>
    checkboxGroup ? checkboxGroup.modelValue.value : props.modelValue
  );

  // è¿˜æ˜¯åˆ¤æ–­å¤šé€‰ç»„
  const model = computed({
    get() {
      return isGroup.value ? store.value : props.modelValue;
    },
    set(val) {
      if (isGroup.value && Array.isArray(val)) {
        checkboxGroup.changeEvent(val);
      } else {
        emit('update:modelValue', val);
      }
    }
  });

  // åˆ¤æ–­å¤šé€‰æ¡†æ˜¯å¦é€‰ä¸­
  const isChecked = computed(() => {
    const value = model.value;
    if (isPropType(value, 'boolean')) {
      return value;
    } else if (isPropType(value, 'array')) {
      return value.includes(props.label);
    }
    return null;
  });

  const onChange = e => {
    const target = e.target;
    const value = target.checked ? true : false;
    emit('change', value, e);
  };

  return {
    model,
    isChecked,
    onChange
  };
};
```
è¿™é‡Œæ¨¡æ¿éœ€è¦ä¿®æ”¹ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥é€‰ä¸­çš„é€‰é¡¹å­—æ®µ `value` å’Œå¤šé€‰æ¡†æ˜¯å¦é€‰ä¸­ `checked`
```vue
  <label
    class="checkbox-wrap"
  >
    <input
      type="checkbox"
      v-model="model"
      :value="label"
      :checked="isChecked"
      @change="onChange"
    />
    <i class="check-icon">âœ“</i>
    <slot></slot>
  </label>
```
å®ç°æ•ˆæœ
![12.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e88ba55ec85d4eb3b9cd2fc33adc80e7~tplv-k3u1fbpfcp-zoom-1.image)
## æ€»ç»“
è¿˜æ˜¯è¦è‡ªå·±åŠ¨æ‰‹å°è£…ï¼Œç»„ä»¶å†…çš„ä¸€äº›ç»†èŠ‚å’Œæ€è·¯å¯¹äºä¸šåŠ¡é€»è¾‘è¿˜æ˜¯æœ‰ä¸€å®šçš„å¯å‘ä½œç”¨ã€‚