# è®©äººæ— å¥ˆçš„å¾®ä¿¡å°ç¨‹åºç»„ä»¶

> æœ¬æ–‡ç›¸å…³ä»£ç åœ°å€ï¼š[github](https://github.com/imondo/mini-apps)


<br />æœ€è¿‘å¼€å‘å¾®ä¿¡å°ç¨‹åºç¢°åˆ°äº†è›®å¤šé—®é¢˜ï¼Œå°¤å…¶æ˜¯å°ç¨‹åºé‡Œé¢çš„ä¸€äº›ç»„ä»¶ï¼Œå®åœ¨æ˜¯è®©äººæ„Ÿè§‰å³æ»¡å¿ƒæ¬¢å–œåˆæ— å¥ˆæ— è¯­ã€‚<br />

<a name="UqbHc"></a>
## web-view
è¿™ä¸ªæ˜¯é¦–å½“å…¶å†²çš„ç»„ä»¶äº†ï¼Œä¸šåŠ¡éƒ¨åˆ†åœºæ™¯ä¸­æ˜¯ä½¿ç”¨çš„ H5 é¡µé¢ï¼Œå°¤å…¶æ˜¯æ´»åŠ¨é¡µé¢æ˜¯å˜åŒ–æœ€é¢‘ç¹çš„ï¼Œæ‰€ä»¥æŸ¥çœ‹[å°ç¨‹åºæ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/component/web-view.html)ï¼Œæœ‰è¿™ä¸ªç»„ä»¶çœŸæ˜¯è®©äººæ¬£å–œï¼›ä¸è¿‡é«˜å…´å¤ªæ—©äº†ã€‚<br />
<br />å…¶é€šä¿¡æœºåˆ¶çœŸæ˜¯è®©äººæ— å¯å¥ˆä½•ï¼š<br />
<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/124135/1596614548712-58af743b-01b3-44cc-9cc2-97320a4a0888.png#align=left&display=inline&height=560&margin=%5Bobject%20Object%5D&name=image.png&originHeight=560&originWidth=1066&size=53360&status=done&style=none&width=1066)å¯ä»¥çœ‹åˆ°ç»„ä»¶é™åˆ¶æœ‰ä¸‰ç‚¹ï¼š

- è‡ªåŠ¨é“ºæ»¡æ•´ä¸ªå°ç¨‹åºé¡µé¢
- å¯¼èˆªæ ä¸å¯ä»¥è‡ªå®šä¹‰
- ä¸¤è¾¹é€šä¿¡éœ€è¦ç‰¹å®šçš„åœºæ™¯


<br />å°ç¨‹åºç»™ `H5` å‘é€æ¶ˆæ¯å®¹æ˜“å®ç°ï¼Œå¯ä»¥ç›´æ¥åœ¨è®¿é—®é“¾æ¥ä¸Šå¸¦ä¸Šæˆ‘ä»¬éœ€è¦çš„å‚æ•°æ¶ˆæ¯
```javascript
<web-view src="test.html?id=2"></web-view>
```
ä½†æ˜¯H5ç»™å°ç¨‹åºå‘é€æ¶ˆæ¯åˆ™éœ€è¦åœ¨ç‰¹å®šçš„åœºæ™¯ï¼š**åé€€ã€é”€æ¯ã€åˆ†äº«**ä¸‰ä¸ªåœºæ™¯é¡µé¢æ‰èƒ½ä¸å°ç¨‹åºé€šä¿¡ã€‚æ„æ€å°±æ˜¯æ²¡æœ‰å‘ç”Ÿä¸Šé¢ä¸‰ä¸ªåœºæ™¯çš„æƒ…å†µä¸‹ï¼Œå°ç¨‹åºæ˜¯æ— æ³•é€šè¿‡ `bindmessage` è¿™ä¸ªäº‹ä»¶è·å–åˆ°é¡µé¢æ¶ˆæ¯ã€‚

æˆ‘ä»¬å¤§éƒ¨åˆ†åœºæ™¯ä¸‹æ˜¯éœ€è¦å®æ—¶é€šä¿¡ï¼Œè¿™é‡Œä½¿ç”¨**åé€€**è¿™ä¸ªåœºæ™¯æ¥å®ç°å®æ—¶é€šä¿¡ï¼Œä½†æ˜¯è¿™ä¸ªå…¶å®æ˜¯ç‰ºç‰²äº†ç”¨æˆ·ä½“éªŒï¼š<br />
<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/124135/1596697447063-382e72d5-c080-4cf0-b2e1-363722c94c6d.png#align=left&display=inline&height=404&margin=%5Bobject%20Object%5D&name=image.png&originHeight=539&originWidth=208&size=16027&status=done&style=none&width=156)<br />
<a name="nzXn4"></a>
### ä¸­é—´é¡µé¢ middle

<br />åˆ©ç”¨ä¸­é—´é¡µé¢ `onLoad` ä¸­æ¥æ”¶å‚æ•° `options` ï¼Œå†æ ¹æ® `getCurrentPages` è·å–åˆ°éœ€è¦è¿”å›åˆ°é¡µé¢ï¼Œè®¾ç½®éœ€è¦çš„æ¶ˆæ¯<br />

```javascript
  onLoad(options) {

    const pages = getCurrentPages();
    console.log(`middleæ¶ˆæ¯ï¼š`, options)

    const webviewPage = pages[pages.length - 2];

    webviewPage.setData(
      {
        options: options
      },
      () => {
        wx.navigateBack({
          delta: 0,
        });
      }
    );
  }
```
<a name="nDsYY"></a>
### ç›®æ ‡é¡µé¢è·å–æ¶ˆæ¯
ç”±äºé€šè¿‡ ` middle` é¡µé¢è®¾ç½®äº† `data` æ•°æ® `options` æ‰€ä»¥å¯ä»¥åœ¨ç¨‹åºå†…è®¿é—®åˆ°å®æ—¶çš„é€šä¿¡æ¶ˆæ¯
```javascript
  onShow() {
    this.setData({
      src: 'https://imondo.cn/files/web.html'
    }, () => {
      console.log(`webé¡µï¼š`, this.data.options)
      if (this.data.options) {
        wx.showModal({
          title: this.data.options.msg
        });
      }
    })
  }
```
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®é™…æ•ˆæœï¼š<br />![view.gif](https://cdn.nlark.com/yuque/0/2020/gif/124135/1596698619066-330a6819-433a-4aee-858d-a3de5c8254bd.gif#align=left&display=inline&height=423&margin=%5Bobject%20Object%5D&name=view.gif&originHeight=564&originWidth=317&size=58936&status=done&style=none&width=238)<br />

<a name="4OY9c"></a>
## scroll-view
è¿™ä¸ªæ»šåŠ¨åŒºåŸŸç»„ä»¶ï¼Œåº”è¯¥æ˜¯æˆ‘ä»¬çœŸå¸¸ç”¨çš„ç»„ä»¶ï¼Œä½†æ˜¯å®ƒç«–å‘æ»šåŠ¨çš„æ—¶å€™ï¼Œä¸€å®šè¦ç»™å®ƒè®¾ä¸€ä¸ª**å›ºå®šé«˜åº¦å€¼**ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¥‡è‘©çš„è®¾å®šã€‚<br />å¹¸å¥½å°ç¨‹åºæœ‰ [wx.createSelectorQuery](https://developers.weixin.qq.com/miniprogram/dev/api/wxml/wx.createSelectorQuery.html) è¿™ä¸ª API æ¥åŠ¨æ€è§£å†³å®ƒçš„é«˜åº¦ï¼š
```javascript
// view
<view>
  <view class="head">Head</view>
  <scroll-view scroll-y="true" style="height: {{scollHeight}}px">
    <block wx:for="{{20}}" wx:key="index">
      <view class="scroll-item">item</view>
    </block>
  </scroll-view>
</view>

// js
onShow() {
  const system = wx.getSystemInfoSync(); // ç³»ç»Ÿé«˜åº¦
  const height = system.windowHeight;
  this.queryEl(['.head']).then(rect => {
    const [{ height: ht }] = rect
    this.setData({
      scollHeight: (height - ht).toFixed(0)
    })
  })
},
queryEl(selector) {
  return new Promise(resolve => {
    const query = wx.createSelectorQuery(); // å¦‚æœæ˜¯åœ¨ component å†…éœ€è¦ä½¿ç”¨ .in(this)
    if (Array.isArray(selector)) {
      selector.forEach(el => {
        query.select(el).boundingClientRect();
      })
    } else {
      query.select(selector).boundingClientRect();
    }
    query.exec(res => {
      resolve(res);
    })
  })
 }
```
å®é™…æ•ˆæœå¦‚ä¸‹ï¼š<br />![scroll.gif](https://cdn.nlark.com/yuque/0/2020/gif/124135/1596700442615-70f2b336-065f-4e5a-9faf-34349a86b018.gif#align=left&display=inline&height=423&margin=%5Bobject%20Object%5D&name=scroll.gif&originHeight=564&originWidth=317&size=109055&status=done&style=none&width=238)
<a name="e5zSd"></a>
## æ€»ç»“
å°ç¨‹åºçš„ç»„ä»¶ä½¿ç”¨è¿‡ç¨‹ä¸­å…¶å®æ–‡æ¡£ä¸­éƒ½æåˆ°äº†ç›¸å…³çš„æ³¨æ„åœ°æ–¹ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚å®åœ¨æ˜¯å¤šå˜ï¼Œå¯¹äºéƒ¨åˆ†ç»„ä»¶çš„ä¸ç¡®å®šæ€§éœ€è¦å¥½å¥½çš„è°ƒç ”æ€»ç»“ï¼Œå¸Œæœ›å°ç¨‹åºç»„ä»¶è¶Šæ¥è¶Šå®Œå–„å§~ ğŸ¤£
