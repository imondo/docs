# è‡ªå®šä¹‰ç»„ä»¶

è¿‘æœŸå¼€å‘ç§»åŠ¨ä¸šåŠ¡å¤šä¸€ç‚¹ï¼Œéƒ½æ˜¯ä½¿ç”¨ `uni-app` å¼€å‘ï¼›å¼€å‘ä¸­ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹å’Œå¼€å‘æŠ€å·§è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿åç»­èƒ½æœ‰ä¸ªåœ°æ–¹æŸ¥è¯ã€‚

## è‡ªå®šä¹‰å¤´éƒ¨å¯¼èˆªæ 

è‡ªå®šä¹‰å¤´éƒ¨åº”è¯¥æ˜¯æœ€å¸¸è§çš„ä¸€ä¸ªéœ€æ±‚ï¼Œä»¥å‰å°ç¨‹åºéƒ½ä¸èƒ½ä¿®æ”¹å¤´éƒ¨æˆ–è€…è¦ä¹ˆåªèƒ½å…¨å±€è‡ªå®šä¹‰ï¼Œåæ¥æ‰é€æ¸æ”¾å¼€å¯ä»¥å•ä¸ªé¡µé¢è‡ªå®šä¹‰å¤´éƒ¨ã€‚

### éšè—è‡ªå¸¦çš„å¯¼èˆªæ 

éœ€è¦è‡ªå®šä¹‰å¤´éƒ¨ï¼Œå¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½• `pages.json` è·¯ç”±ä¸Šè®¾ç½® `navigationStyle: custom`ã€‚

```json
// pages.json
{
  "path": "pages/test/test",
  "style": {
   "navigationStyle": "custom"
  }
}
```

å¦‚æœè¦å…¨å±€éšè—

```json
"globalStyle": {
   "navigationStyle": "custom"
}
```

### è‡ªå®šä¹‰å¯¼èˆª

è‡ªå®šä¹‰å¤´éƒ¨éœ€è¦è®¡ç®—å¯¼èˆªæ é«˜åº¦

```html
<!--  page-head -->
<template>
  <view class="nav-box" :style="{height: navBarHeight + 'px'}">
    <view class="capsule-box" :style="{height: menuHeight + 'px', 'line-height': menuHeight + 'px', bottom: menuBottom + 'px'}">
      <view class="nav-title">
        <view v-if="!!title" class="nav">{{title}}</view>
      </view>
    </view>
  </view>
</template>
```

å¯¼èˆªæ é«˜åº¦åˆç”±å‡ ä¸ªé«˜åº¦è®¡ç®—è€Œæ¥ï¼š`çŠ¶æ€æ åˆ°èƒ¶å›Šçš„é—´è·ï¼ˆèƒ¶å›Šä¸Šåæ ‡ä½ç½®-çŠ¶æ€æ é«˜åº¦ï¼‰ * 2 + èƒ¶å›Šé«˜åº¦ + çŠ¶æ€æ é«˜åº¦`ã€‚

çŠ¶æ€æ çš„é«˜åº¦ï¼š[uni.getSystemInfoSync](https://uniapp.dcloud.net.cn/api/system/info.html)

```js
// è·å–ç³»ç»Ÿä¿¡æ¯
const systemInfo = uni.getSystemInfoSync();
// çŠ¶æ€æ 
systemInfo.statusBarHeight
```

è€Œèƒ¶å›Šä¿¡æ¯å¯ä»¥é€šè¿‡ï¼š[uni.getMenuButtonBoundingClientRect](https://uniapp.dcloud.net.cn/api/ui/menuButton.html#getmenubuttonboundingclientrect) è·å–

```js
/**
 * è·å–å¾®ä¿¡å°ç¨‹åºèœå•æ (èƒ¶å›Š)ä¿¡æ¯
 * èœå•æŒ‰é”®å®½åº¦ï¼šwidth
 * èœå•æŒ‰é”®é«˜åº¦ï¼šheight
 * èœå•æŒ‰é”®ä¸Šè¾¹ç•Œåæ ‡ï¼štop
 * èœå•æŒ‰é”®å³è¾¹ç•Œåæ ‡ï¼šright
 * èœå•æŒ‰é”®ä¸‹è¾¹ç•Œåæ ‡ï¼šbottom
 * èœå•æŒ‰é”®å·¦è¾¹ç•Œåæ ‡ï¼šleft
 */
menuButtonInfo = uni.getMenuButtonBoundingClientRect();
```

æœ€åè®¾ç½®é«˜åº¦

```js
  props: {
  title: String
 },
  data() {
   return {
      navBarHeight: 0,
      menuBottom: 0,
      menuHeight: 0
   };
  },
  mounted() {
    this.$nextTick(() => {
      this.calcNavBarInfo();
    })
  },
  methods: {
    // è®¡ç®—å¯¼èˆªæ é«˜åº¦
    calcNavBarInfo() {
      // è·å–ç³»ç»Ÿä¿¡æ¯
      const systemInfo = uni.getSystemInfoSync();
      const menuButtonInfo = this.getMenuButtonInfo(systemInfo);
      // èƒ¶å›ŠæŒ‰é’®ä½ç½®ä¿¡æ¯
      // å¯¼èˆªæ é«˜åº¦ = çŠ¶æ€æ åˆ°èƒ¶å›Šçš„é—´è·ï¼ˆèƒ¶å›Šä¸Šåæ ‡ä½ç½®-çŠ¶æ€æ é«˜åº¦ï¼‰ * 2 + èƒ¶å›Šé«˜åº¦ + çŠ¶æ€æ é«˜åº¦
      const navBarHeight = (menuButtonInfo.top - systemInfo.statusBarHeight) * 2 + menuButtonInfo.height + systemInfo.statusBarHeight;
      // çŠ¶æ€æ å’Œèœå•æŒ‰é’®(æ ‡é¢˜æ )ä¹‹é—´çš„é—´è·
      // ç­‰åŒäºèœå•æŒ‰é’®(æ ‡é¢˜æ )åˆ°æ­£æ–‡ä¹‹é—´çš„é—´è·ï¼ˆèƒ¶å›Šä¸Šåæ ‡ä½ç½®-çŠ¶æ€æ é«˜åº¦ï¼‰
      const menuBottom = menuButtonInfo.top - systemInfo.statusBarHeight;
      // èœå•æŒ‰é’®æ (æ ‡é¢˜æ )çš„é«˜åº¦
      const menuHeight = menuButtonInfo.height;
      this.navBarHeight = navBarHeight;
      this.menuBottom = menuBottom;
      this.menuHeight = menuHeight;
      this.$emit('getnavinfo', {
        navBarHeight,
        menuBottom,
        menuHeight,
        systemInfo
      });
    },
    // åˆ¤æ–­æ˜¯å¦ä¸º IOS
    checkSystem(res) {
      const { system } = res;
      const _sys = system.toLocaleUpperCase();
      return _sys.includes('IOS');
    },
    getMenuButtonInfo(systemInfo) {
      // fix: IOS è·å–èƒ¶å›Šä¿¡æ¯å­˜åœ¨0å€¼æƒ…å†µï¼Œç”±äº IOS èƒ¶å›Šä¿¡æ¯å›ºå®šæ‰€ä»¥ç›´æ¥å›ºå®šå€¼
      let menuButtonInfo = {
        width: 87,
        height: 32,
        left: systemInfo.screenWidth - 7 - 87,
        right: systemInfo.screenWidth - 7,
        top: systemInfo.statusBarHeight + 4,
        bottom: systemInfo.statusBarHeight + 4 + 32
      };
      const isIOS = this.checkSystem(systemInfo);
      if (isIOS) {
        // iosè®¾å¤‡çš„èƒ¶å›ŠæŒ‰é’®éƒ½æ˜¯å›ºå®šçš„
        return menuButtonInfo;
      } else {
        menuButtonInfo = uni.getMenuButtonBoundingClientRect();
      }
      return menuButtonInfo;
    }
  } 
```

å®ç°æ•ˆæœï¼š


![page-head.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8cd18a20efd64c289409e955bbee4d98~tplv-k3u1fbpfcp-watermark.image?)
## è‡ªå®šä¹‰å†…å®¹åŒº

å½“è‡ªå®šä¹‰å¤´éƒ¨å¯¼èˆªæ åï¼Œå¦‚æœé¡µé¢å­˜åœ¨æ»šåŠ¨æ¡æ—¶ï¼Œä¼šå‡ºç°æ»šåŠ¨æ¡åœ¨å¯¼èˆªæ ä¸Šï¼›å¯¹äº `UI` æ˜¯ä¸èƒ½å¿çš„ï¼Œæ²¡åŠæ³•éšå« `UI` æ˜¯ä¸ªå¦¹å­å‘¢ğŸ˜‰

å…¶å®ä¹Ÿç®€å•ï¼Œåªè¦ä½¿ç”¨ `scroll-view` ç»„ä»¶åŒ…è£¹å†…å®¹åŒºå°±è¡Œï¼Œéº»çƒ¦ç‚¹çš„æ˜¯éœ€è¦è®¾ç½® `scroll-view` çš„é«˜åº¦ã€‚è€Œå®ƒçš„é«˜åº¦å…¶å®å°±æ˜¯

```js
å¯è§†åŒºåŸŸé«˜åº¦ - å¯¼èˆªæ é«˜åº¦
```

- å®šä¹‰ç»„ä»¶ page-layout

```html
<template>
 <view class="page-layout">
  <page-head class="nav-ref" v-if="!!title" :title="title" @getnavinfo="getNavInfo"></page-head>
  <scroll-view class="page-container" enable-back-to-top scroll-y
   :style="{'padding-top': !!title ? containerStyle: '0', 'height': containerHeight}">
   <slot></slot>
  </scroll-view>
 </view>
</template>
```

éœ€è¦åœ¨ `page-head` ç»„ä»¶ä¸­å‘é€å‡ºå¯¼èˆªæ é«˜åº¦ä¿¡æ¯

```js
calcNavBarInfo() {
  // ...
  this.$emit('getnavinfo', {
    navBarHeight,
    menuBottom,
    menuHeight,
    systemInfo
  });
}

```

è®¡ç®—å½“å‰å†…å®¹é«˜åº¦

```js
const getNavInfo = (options: any) => {
  const {
    navBarHeight,
    systemInfo
  } = options;
  containerStyle.value = (navBarHeight) + 'px'
  containerHeight.value = (systemInfo.screenHeight - navBarHeight) + 'px'
}

```


![page-layout.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e71869aa0dad4ea99f74ccac43f8043d~tplv-k3u1fbpfcp-watermark.image?)
## è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆª

åº•éƒ¨å¯¼èˆªä¹Ÿæ˜¯ `UI` å¦¹å­æœ€å–œæ¬¢å¼„å¾—èŠ±é‡Œèƒ¡å·§ä¸€ä¸ªåœ°æ–¹ã€‚å¹¸å¥½å¾®ä¿¡æ”¾å¼€äº†åº•éƒ¨å¯¼èˆªçš„è‡ªå®šä¹‰ï¼Œä¸ç„¶åˆè¦è¢«å¦¹å­å«Œå¼ƒğŸ˜’

- å…ˆé…ç½®å¯¼èˆª

å…ˆè¦åœ¨ `pages.json` ä¸­é…ç½®å¯¼èˆªï¼Œæ³¨æ„å¯¼èˆª**æœ€å°‘2ä¸ª**ï¼›åœ¨é…ç½® `"custom": true`

```json
"tabBar": {
		"custom": true,
		"list": [
			{
				"pagePath": "pages/index/index"
			},
			{
				"pagePath": "pages/user/user"
			}
		]
	},
```

- ç¼–å†™åº•éƒ¨å¯¼èˆª

è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆªï¼Œéœ€è¦æŒ‰ç…§[å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/custom-tabbar.html)è¿›è¡Œï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `custom-tab-bar` ç›®å½•

```bash
custom-tab-bar/index.js
custom-tab-bar/index.json
custom-tab-bar/index.wxml
custom-tab-bar/index.wxss
```
**æ³¨æ„ï¼šä½¿ç”¨ `uni-app` å¼€å‘ä¹Ÿéœ€è¦åŒä¸Šè¿°æ­¥éª¤ä¸€æ ·ï¼Œåˆ›å»ºç›¸å…³æ–‡ä»¶ï¼Œä¸èƒ½ä½¿ç”¨ .vue æ–‡ä»¶å¼€å‘**

å¯¼èˆªçš„å¸ƒå±€å¤§åŒå°å¼‚

```html
<view class="tab-bar-box">
  <view wx:for="{{list}}" wx:key="id" class="tab-item" data-id="{{item.id}}" bindtap="onChange">
    <view class="icon">
      <image
        src="{{selected == item.id ? item.selectedIconPath : item.iconPath}}"
        mode="scaleToFill" 
        alt="user" 
      />
  </view>
</view>
```
```js
Component({
  data: {
    selected: 0,
    list: [
      {
        id: 1,
        iconPath: ICON_PREX + 'home.svg',
        selectedIconPath: ICON_PREX + 'homeed.svg',
        text: 'é¦–é¡µ',
        path: '/pages/index/index',
      },
      {
        id: 2,
        iconPath: ICON_PREX + 'user.svg',
        selectedIconPath: ICON_PREX + 'usered.svg',
        text: 'ç”¨æˆ·',
        path: '/pages/user/user',
      }
    ]
  },
  methods: {
    // æ ‡ç­¾åˆ‡æ¢
    onChange: function (e) {
      const { dataset: { id } } = e.currentTarget;
	    const row = this.data.list.find(v => v.id === id);
      wx.switchTab({
        url: row.path,
      })
    }
  }
})
```
ç»„ä»¶ç¼–å†™å®Œæˆï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ¯ä¸ª `tabbar` æ¨¡å—å¤„ç†ã€‚éœ€è¦åœ¨ tabbar æ¨¡å—å„è‡ªå¤„ç†

```js
export function setTabBarIndex(index: number) {
	const curPages = getCurrentPages()[0] as { getTabBar: Function };  // è·å–å½“å‰é¡µé¢å®ä¾‹  
	if (typeof curPages.getTabBar === 'function') { 
	    curPages.getTabBar().setData({  
	        selected:  index 
	    });  
	}
}

// index.vue
onMounted(() => {
  setTabBarIndex(0);
})
```

ä¸Šé¢æ˜¯ Vue3 çš„å†™æ³•ï¼Œå¦‚æœæ˜¯ Vue2ï¼Œåˆ™éœ€è¦åœ¨ `onShow` å¤„ç†

```js
// index.vue
onShow() {
  this.$mp.page.getTabBar().setData({
      selected: 0
  });
}
```

æ•ˆæœå¦‚ä¸‹ï¼š

![page-tabbar.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5b6d406a69304465bd2dbf4c55662a65~tplv-k3u1fbpfcp-watermark.image?)

## åŠ¨æ€å»é™¤ page-head

> åªé’ˆå¯¹ H5 å¹³å°

`H5` å¹³å°çš„æ—¶å€™ï¼Œå¾®ä¿¡æµè§ˆå™¨éœ€è¦å»æ‰å¤´éƒ¨å¯¼èˆªï¼Œä½†åœ¨æ‰‹æœºæµè§ˆå™¨åˆéœ€è¦å­˜åœ¨å¤´éƒ¨å¯¼èˆªï¼Œè¿™æ—¶åªèƒ½åŠ¨æ€è®¾ç½® page-headã€‚

- å…ˆéšè—

å…ˆå¯¹ `page-head` éšè—

```css
/* #ifdef H5 */
uni-page-head {
 display: none;
}
/* #endif */
```

- åˆ¤æ–­å¹³å°ä¸ç¯å¢ƒ

```js
Vue.mixin({
 onShow() {
  // #ifdef H5
  if (isWeixin()) {
   this.navTitle();
  } else {
   this.navTitle('block');
  }
  // #endif
 },
 methods: {
  navTitle(show = 'none') {
   const navTitle = document.getElementsByTagName('uni-page-head');
   if (navTitle) {
    navTitle.forEach((nav) => {
     nav.style.display = show;
    })
   }
   if (show === 'none') {
    // sticky å…¨å±€è®¾ç½®ï¼Œåœ¨å¾®ä¿¡ç¯å¢ƒä¸‹ç½®é¡¶
    document.documentElement.style.setProperty('--sticky-top', '0');
    document.documentElement.style.setProperty('--window-top', '0');
   }
  }
 }
});
```

è¿™é‡Œæ˜¯ Vue 2 å†™æ³•ï¼Œ Vue3 çš„å†™æ³•ä¹Ÿå¤§è‡´ç±»ä¼¼

```js
export function createApp() {
	const app = createSSRApp(App)

	app.mixin({
    // ...
  })
	return {
		app
	}
}
```
## æ€»ç»“

å¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œåªè¦æ˜¯ç†Ÿæ‚‰ Vue æŠ€æœ¯æ ˆçš„è¯ï¼Œå®Œå…¨å¯ä»¥å¿«é€Ÿä¸Šæ‰‹å®ç°ä¸šåŠ¡éœ€æ±‚ï¼›ä¸è¿‡ä¸å¾—ä¸è¯´å®ƒçš„æ–‡æ¡£æ˜¯æ™®éè¢«åæ§½çš„æœ€å¤šçš„ï¼Œè‡ªå·±ä¹Ÿæ˜¯è¢«è¯¯å¯¼å¤šæ¬¡ã€‚ä½†æ˜¯é€‰ç”¨ `uni-app` å¼€å‘å…¶å®å¯¹äºå°å…¬å¸æˆ–è€…æ˜¯å¿«é€Ÿå®ç° `mvp` æ˜¯æœ€åˆ’ç®—æœ€ä¾¿æ·ã€‚è‡ªå·±ä¹Ÿç”¨å®ƒè‡ªå·±å¼€å‘äº†ä¸€ä¸ª [IOS APP](https://imondo.cn/files/apps/car/) å’Œå°ç¨‹åºæ¬¢è¿ä½“éªŒä½¿ç”¨ä¸åé¦ˆã€‚

![lite.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e074e4c045654722a6f3a36c81fe3231~tplv-k3u1fbpfcp-watermark.image?)