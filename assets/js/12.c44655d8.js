(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{344:function(s,e,n){"use strict";n.r(e);var a=n(17),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"前端常见下载处理方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端常见下载处理方案"}},[s._v("#")]),s._v(" 前端常见下载处理方案")]),s._v(" "),n("p",[s._v("下载是我们项目中常常会遇到的需求，不同的下载方案能呈现不同的效果，近期归纳下作者系统中用到常见几种下载处理方案")]),s._v(" "),n("h2",{attrs:{id:"a标签下载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#a标签下载"}},[s._v("#")]),s._v(" a标签下载")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<a href="test.xlsx" download="test.txt">下载</a>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("这种是我们常见的下载静态文件的处理方式，这种适用于项目文件是"),n("strong",[s._v("静态")]),s._v("的以及"),n("strong",[s._v("存放地点不变动")]),s._v("的。"),n("code",[s._v("download")]),s._v("属性还可以对文件命名处理")]),s._v(" "),n("h2",{attrs:{id:"form表单下载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#form表单下载"}},[s._v("#")]),s._v(" Form表单下载")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<form method="get" target="name" action="test.com">\n    <input type="hidden" name="token" value="token">\n    <input type="hidden" name="url" value="/api/download">\n</form>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("表单的下载可以做特殊的"),n("code",[s._v("传值")]),s._v("处理，也可以传入更多的参数；请求方式也多种多样。")]),s._v(" "),n("h2",{attrs:{id:"blob流下载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#blob流下载"}},[s._v("#")]),s._v(" Blob流下载")]),s._v(" "),n("p",[s._v("用上面方式下载处理，当用户点击下载时，前端不能够很好的捕捉到请求的状态，而用"),n("code",[s._v("Blob")]),s._v("我们可以更灵活的来处理不同状态。")]),s._v(" "),n("blockquote",[n("p",[s._v("Blob 对象表示一个不可变、原始数据的类文件对象。")])]),s._v(" "),n("p",[s._v("简单的示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const disposition = decodeURI(xhr.getResponseHeader('Content-Disposition')); // 文件名处理\nconst dispositionArray = disposition.split('filename=');\nconst name = dispositionArray[dispositionArray.length - 1];\nconst disposition = decodeURI(xhr.getResponseHeader('Content-Disposition')); // 文件名处理\nconst dispositionArray = disposition.split('filename=');\nconst name = dispositionArray[dispositionArray.length - 1];\nconst blob = window.URL.createObjectURL(res.data); // 创建对象URL \nreader.onload = function(e) {\n  const link = document.createElement('a');\n  link.style.display = 'none';\n  link.href = blob;\n  link.setAttribute('download', decodeURI(fileName));\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  window.URL.revokeObjectURL(blob);\n};\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("后端需要设置")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Access-Control-Expose-Headers: Content-Disposition\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("通过后台返回的数据来判断是否显示错误提示，也可以根据接口不同状态值来显示。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('const reader = new FileReader();\nreader.onload = e => {\n  if (e.target.result.includes(\'"data":""\')) {\n    const result = JSON.parse(e.target.result);\n    console.log(result.msg);\n  }\n};\nreader.readAsText(response); // 读取指定的Blob中的内容，result属性中将包含一个字符串以表示所读取的文件内容。\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("p",[s._v("以上的三种处理方案是我们常见的前端下载简单汇总，方案不同，效果不同，不过还是推荐"),n("code",[s._v("Blob")]),s._v("方式下载，这种处理方式，可以更加灵活的捕捉到不同状态，前端可以更加方便的处理。")])])}),[],!1,null,null,null);e.default=t.exports}}]);