(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{238:function(e,t,n){"use strict";n.r(t);var a=n(0),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"【vue项目总结】项目nginx部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#【vue项目总结】项目nginx部署"}},[e._v("#")]),e._v(" 【Vue项目总结】项目nginx部署")]),e._v(" "),n("p",[e._v("项目开发完成，接下来是上线，关于"),n("code",[e._v("vue")]),e._v("项目的部署，我司前端是部署在"),n("code",[e._v("nginx")]),e._v("服务器上，关于"),n("code",[e._v("nginx")]),e._v("的相关文档，请自行查阅；本文只记录部署时碰到的一些问题。")]),e._v(" "),n("h2",{attrs:{id:"打包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#打包"}},[e._v("#")]),e._v(" 打包")]),e._v(" "),n("p",[n("code",[e._v("vue")]),e._v("项目打包后，是生成一系列的静态文件，包括项目的请求"),n("code",[e._v("IP")]),e._v("都打入包内，如果后台服务改动，这时你的前端文件，又要重新编译打包，这里采用的是"),n("a",{attrs:{href:"https://juejin.im/post/5cedfea96fb9a07ef06f761e#heading-0",target:"_blank",rel:"noopener noreferrer"}},[e._v("后台管理项目总结"),n("OutboundLink")],1),e._v("提到的前端自行请求一个配置文件，动态修改你的相关配置。")]),e._v(" "),n("ul",[n("li",[e._v("静态文件")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('// config.json\n{\n  "api": "test.com"\n}\n')])])]),n("ul",[n("li",[e._v("请求文件")])]),e._v(" "),n("p",[e._v("在项目"),n("code",[e._v("store")]),e._v("中请求你的配置文件，写入"),n("code",[e._v("state")]),e._v("中，在调用的时候可以全局访问到你的配置")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// api.js\nGetConfigApi() {\n  return new Promise((resolve, reject) => {\n    axios\n      .get(`/config.json?v=${new Date().getTime()}`)\n      .then(result => {\n        const configApi = {\n          API: result.data['api'], // 统一接口\n        };\n        resolve(configApi);\n      })\n      .catch(error => {\n        reject(error);\n      });\n  });\n}\n")])])]),n("h2",{attrs:{id:"nginx部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx部署"}},[e._v("#")]),e._v(" nginx部署")]),e._v(" "),n("p",[e._v("因为"),n("code",[e._v("vue-router")]),e._v("有"),n("code",[e._v("hash")]),e._v("和"),n("code",[e._v("history")]),e._v("不同的两种模式，使用不同的模式，"),n("code",[e._v("nginx")]),e._v("的配置不同，"),n("code",[e._v("hash")]),e._v("模式下，不需要改动，只需要部署你的前端文件就可以了，所以这里只讨论"),n("code",[e._v("history")]),e._v("模式下"),n("code",[e._v(".conf")]),e._v("文件的修改")]),e._v(" "),n("p",[e._v("访问修改"),n("code",[e._v("nginx")]),e._v("配置文件"),n("code",[e._v("nginx.conf")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("server {\n  listen  80;\n  server_name  test.com;\n\n  location / {\n    root  /front; // 前端文件路径\n    index  index.html; // hash模式只配置访问html就可以了\n    try_files $uri $uri/ /index.html; // history模式下\n  }\n}\n")])])]),n("p",[e._v("修改完成，重启服务访问"),n("code",[e._v("test.com")])]),e._v(" "),n("h2",{attrs:{id:"部署到子级目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署到子级目录"}},[e._v("#")]),e._v(" 部署到子级目录")]),e._v(" "),n("p",[e._v("当我们需要把项目部署到子级目录下时，则需要修改项目的"),n("code",[e._v("BASE_URL")]),e._v("，生成一个子级目录下的绝对访问路径。修改对应的"),n("code",[e._v(".conf")]),e._v("配置文件")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("server {\n  listen  80;\n  server_name  test.com;\n\n  location /demo { // 子级目录\n    alias  /front/demo;\n    index  index.html;\n    try_files $uri $uri/ /demo/index.html; \n  }\n}\n")])])]),n("p",[e._v("修改完成，重启服务访问"),n("code",[e._v("test.com/demo")])]),e._v(" "),n("h2",{attrs:{id:"缓存处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缓存处理"}},[e._v("#")]),e._v(" 缓存处理")]),e._v(" "),n("p",[e._v("前端项目的静态文件常常会被浏览器缓存，而项目编译后，"),n("code",[e._v("js")]),e._v("，"),n("code",[e._v("css")]),e._v("，图片等实际上是已经有"),n("code",[e._v("hash")]),e._v("值来去除了缓存，但是项目更新后，仍然会出现缓存问题，这是由于我们的项目整个入口都是在"),n("code",[e._v("index.html")]),e._v("文件上，浏览器实际是缓存了我们的"),n("code",[e._v("html")]),e._v("页面，所以我们要在"),n("code",[e._v("nginx")]),e._v("中告诉浏览器，"),n("code",[e._v("html")]),e._v("文件不被缓存。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("  location /demo {\n    add_header Cache-Control 'private, no-store, max-age=0';\n    ...\n  }\n")])])]),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),n("p",[e._v("这里只讨论了"),n("code",[e._v("nginx")]),e._v("相关的部署，实际上"),n("code",[e._v("vue-router")]),n("a",{attrs:{href:"https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90",target:"_blank",rel:"noopener noreferrer"}},[e._v("文档"),n("OutboundLink")],1),e._v("上是有相关的配置例子的。")]),e._v(" "),n("p",[e._v("其他总结文章：")]),e._v(" "),n("ul",[n("li",[n("router-link",{attrs:{to:"/Note/webpack/webpack.html"}},[e._v("webpack常规打包优化方案")])],1),e._v(" "),n("li",[n("router-link",{attrs:{to:"/Note/vue/props.html"}},[e._v("组件通信处理方案")])],1),e._v(" "),n("li",[n("router-link",{attrs:{to:"/Note/vue/http.html"}},[e._v("后台管理项目总结")])],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);