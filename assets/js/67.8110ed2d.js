(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{433:function(t,s,a){"use strict";a.r(s);var n=a(22),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"微信小程序优化思路"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微信小程序优化思路"}},[t._v("#")]),t._v(" 微信小程序优化思路")]),t._v(" "),a("p",[t._v("这里的小程序特指"),a("strong",[t._v("微信小程序")])]),t._v(" "),a("h2",{attrs:{id:"指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指标"}},[t._v("#")]),t._v(" 指标")]),t._v(" "),a("ul",[a("li",[t._v("FCP：白屏加载结束；")]),t._v(" "),a("li",[t._v("FMP：首屏渲染完成；")]),t._v(" "),a("li",[t._v("TTI：所有内容加载完成；")])]),t._v(" "),a("h3",{attrs:{id:"官方性能指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#官方性能指标"}},[t._v("#")]),t._v(" 官方性能指标")]),t._v(" "),a("p",[t._v("主要围绕 "),a("strong",[t._v("渲染表现")]),t._v("、"),a("strong",[t._v("setData 数据量")]),t._v("、"),a("strong",[t._v("元素节点数")]),t._v(" 和 "),a("strong",[t._v("网络请求延时")]),t._v(" 这几个维度来给予定义；")]),t._v(" "),a("ul",[a("li",[t._v("首屏时间不超过 5 秒；")]),t._v(" "),a("li",[t._v("渲染时间不超过 500ms；")]),t._v(" "),a("li",[t._v("每秒调用 "),a("code",[t._v("setData")]),t._v(" 的次数不超过 20 次；")]),t._v(" "),a("li",[a("code",[t._v("setData")]),t._v(" 的数据在 "),a("code",[t._v("JSON.stringify")]),t._v(" 后不超过 256kb；")]),t._v(" "),a("li",[t._v("页面 WXML 节点少于 1000 个，节点树深度少于 30 层，子节点数不大于 60 个；")]),t._v(" "),a("li",[t._v("所有网络请求都在 1 秒内返回结果；")])]),t._v(" "),a("blockquote",[a("p",[t._v("微信小程序性能"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/audits/performance.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("指标详解"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"性能分析工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能分析工具"}},[t._v("#")]),t._v(" 性能分析工具")]),t._v(" "),a("ul",[a("li",[t._v("体验"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/audits/audits.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("评分工具"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("小程序"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/performanceReport/",target:"_blank",rel:"noopener noreferrer"}},[t._v("测速系统"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("小程序管理平台")]),t._v(" "),a("li",[t._v("小程序助手")])]),t._v(" "),a("h2",{attrs:{id:"小程序底层架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序底层架构"}},[t._v("#")]),t._v(" 小程序底层架构")]),t._v(" "),a("p",[t._v("不同于传统浏览器"),a("strong",[t._v("单线程")]),t._v("，小程序采用"),a("strong",[t._v("双线程模型。")])]),t._v(" "),a("ul",[a("li",[t._v("视图层：Webview 线程，启用不同 webview 来渲染不同的小程序页面")]),t._v(" "),a("li",[t._v("逻辑层：单独的线程执行 JS 代码，可以控制视图层的逻辑")])]),t._v(" "),a("p",[a("strong",[t._v("优势："),a("strong",[t._v("不会经常出现")]),t._v("阻塞")]),t._v("情况")]),t._v(" "),a("p",[a("strong",[t._v("任何线程间的数据传输都是有延时的")]),t._v("，意味着逻辑层和视图层间通信是"),a("strong",[t._v("异步行为")]),t._v("\n**")]),t._v(" "),a("h2",{attrs:{id:"启动慢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动慢"}},[t._v("#")]),t._v(" 启动慢")]),t._v(" "),a("p",[a("strong",[t._v("启动过程：")])]),t._v(" "),a("ul",[a("li",[t._v("准备运行环境：启动双线程环境，并在线程中完成小程序基础库的初始化和预执行")]),t._v(" "),a("li",[t._v("下载小程序代码包：下载编译后的代码包到本地，有缓存优先读取缓存")]),t._v(" "),a("li",[t._v("加载小程序代码包：基础库会完成所有页面的注册")]),t._v(" "),a("li",[t._v("初始化小程序首页")])]),t._v(" "),a("p",[a("strong",[t._v("优化：")])]),t._v(" "),a("ul",[a("li",[t._v("无用文件，函数，样式剔除")]),t._v(" "),a("li",[t._v("减少代码包中静态资源文件：图片启用CDN")]),t._v(" "),a("li",[t._v("逻辑后移，精简前端逻辑：不涉及前端计算展示类逻辑，都可后移")]),t._v(" "),a("li",[t._v("复用模板插件")]),t._v(" "),a("li",[t._v("分包加载")]),t._v(" "),a("li",[t._v("部分页面 H5 化")])]),t._v(" "),a("h2",{attrs:{id:"白屏时间长"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#白屏时间长"}},[t._v("#")]),t._v(" 白屏时间长")]),t._v(" "),a("p",[a("strong",[t._v("影响因数：")])]),t._v(" "),a("ul",[a("li",[t._v("网络资源加载时间")]),t._v(" "),a("li",[t._v("渲染时间")])]),t._v(" "),a("p",[a("strong",[t._v("优化")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("启用本地缓存")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/ability/pre-fetch.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("数据预拉取"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("跳转时预拉取")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/preload.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("分包预下载"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("非关键渲染数据延迟请求")]),t._v(" "),a("li",[t._v("分屏渲染")]),t._v(" "),a("li",[t._v("接口聚合，请求合并")]),t._v(" "),a("li",[t._v("骨架屏")]),t._v(" "),a("li",[t._v("图片资源优化\n"),a("ul",[a("li",[t._v("使用 WebP 格式")]),t._v(" "),a("li",[t._v("图片裁剪&降质")]),t._v(" "),a("li",[t._v("图片懒加载，雪碧图优化")]),t._v(" "),a("li",[t._v("降级加载大图资源：我们可以先呈现高度压缩的模糊图片，同时利用一个隐藏的  节点来加载原图，待原图加载完成后再转移到真实节点上渲染")])])])]),t._v(" "),a("p",[t._v("注意，具有 display: none 样式的  标签只会加载图片资源，但不渲染。")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" banner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wxml "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{url}}"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" 图片加载器 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("image\n  style"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"width:0;height:0;display:none"')]),t._v("\n  src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{preloadUrl}}"')]),t._v("\n  bindload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"onImgLoad"')]),t._v("\n  binderror"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"onErrorLoad"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// banner.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ready")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("originUrl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://path/to/picture'")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 图片源地址")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("compress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("originUrl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加载压缩降质的图片")]),t._v("\n      preloadUrl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("originUrl                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 预加载原图")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  methods"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onImgLoad")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("originUrl                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加载原图")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("h2",{attrs:{id:"渲染性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染性能"}},[t._v("#")]),t._v(" 渲染性能")]),t._v(" "),a("p",[a("strong",[t._v("跳转页面过程：")])]),t._v(" "),a("ul",[a("li",[t._v("准备新的 webview 线程环境，包括基础库的初始化；")]),t._v(" "),a("li",[t._v("从逻辑层到视图层的初始数据通信；")]),t._v(" "),a("li",[t._v("视图层根据逻辑层的数据，结合 WXML 片段构建出节点树（包括节点属性、事件绑定等信息），最终与 WXSS 结合完成页面渲染；")])]),t._v(" "),a("p",[t._v("由于微信会提前开始准备 webview 线程环境，所以小程序的渲染损耗主要在后两者 数据通信 和 节点树创建/更新 的流程中。相对应的，比较有效的渲染性能优化方向就是：")]),t._v(" "),a("ul",[a("li",[t._v("降低线程间通信频次")]),t._v(" "),a("li",[t._v("减少线程间通信的数据量")]),t._v(" "),a("li",[t._v("减少 WXML 节点数量")])]),t._v(" "),a("p",[a("strong",[t._v("优化")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("合并 "),a("code",[t._v("setData")]),t._v("  调用")]),t._v(" "),a("li",[t._v("只把渲染相关的数据放在 "),a("code",[t._v("data")]),t._v("  中")]),t._v(" "),a("li",[t._v("应用层的数据 diff")]),t._v(" "),a("li",[t._v("组件层的 diff")]),t._v(" "),a("li",[t._v("去掉不必要的事件绑定")]),t._v(" "),a("li",[t._v("去掉不必要的节点属性")]),t._v(" "),a("li",[t._v("适当的组件颗粒度")]),t._v(" "),a("li",[t._v("事件总线，替代组件间数据绑定的通信方式：eventBus")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 全局事件调度")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventBus")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("trigger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("events"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" event "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventBus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 事件订阅者　子组件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("created")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data-ready'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//　事件发布着　Parent")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ready")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("trigger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data-ready'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br")])]),a("h2",{attrs:{id:"内存高"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内存高"}},[t._v("#")]),t._v(" 内存高")]),t._v(" "),a("p",[a("strong",[t._v("当小程序占用系统资源过高，就有可能会被系统销毁或被微信客户端主动回收")]),t._v("\n**")]),t._v(" "),a("ul",[a("li",[t._v("内存预警："),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/device/performance/wx.onMemoryWarning.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.onMemoryWarning"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("回收后台页面计时器：在页面 "),a("strong",[t._v("onHide")]),t._v(" 的时候手动把定时器清理掉，有必要时再在 "),a("strong",[t._v("onShow")]),t._v(" 阶段恢复定时器")]),t._v(" "),a("li",[t._v("避免频发事件中的重度内存操作\n"),a("ul",[a("li",[a("code",[t._v("onPageScroll")]),t._v(" 事件回调使用节流")]),t._v(" "),a("li",[t._v("避免 "),a("code",[t._v("CPU")]),t._v(" 密集型操作，譬如复杂的计算")]),t._v(" "),a("li",[t._v("避免调用 "),a("code",[t._v("setData")]),t._v("，或减小 "),a("code",[t._v("setData")]),t._v(" 的数据量")]),t._v(" "),a("li",[t._v("尽量使用 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wxml/IntersectionObserver.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("IntersectionObserver"),a("OutboundLink")],1),t._v(" 来替代 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wxml/SelectorQuery.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("SelectorQuery"),a("OutboundLink")],1),t._v("，前者对性能影响更小")])])]),t._v(" "),a("li",[t._v("大图，长列表优化："),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/extended/functional/recycle-view.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("长列表组件"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("strong",[t._v("参考：")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://juejin.im/post/5e7d4487e51d4546d83af560?utm_source=gold_browser_extension",target:"_blank",rel:"noopener noreferrer"}},[t._v("京喜小程序的高性能打造之路"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/_NSJTQ-4-8gTnwTVK-tn0A",target:"_blank",rel:"noopener noreferrer"}},[t._v("小程序工程化探索"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);