(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{242:function(s,e,n){"use strict";n.r(e);var a=n(0),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"【vue项目总结】项目nginx部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#【vue项目总结】项目nginx部署"}},[s._v("#")]),s._v(" 【Vue项目总结】项目nginx部署")]),s._v(" "),n("p",[s._v("项目开发完成，接下来是上线，关于"),n("code",[s._v("vue")]),s._v("项目的部署，我司前端是部署在"),n("code",[s._v("nginx")]),s._v("服务器上，关于"),n("code",[s._v("nginx")]),s._v("的相关文档，请自行查阅；本文只记录部署时碰到的一些问题。")]),s._v(" "),n("h2",{attrs:{id:"打包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#打包"}},[s._v("#")]),s._v(" 打包")]),s._v(" "),n("p",[n("code",[s._v("vue")]),s._v("项目打包后，是生成一系列的静态文件，包括项目的请求"),n("code",[s._v("IP")]),s._v("都打入包内，如果后台服务改动，这时你的前端文件，又要重新编译打包，这里采用的是"),n("a",{attrs:{href:"https://juejin.im/post/5cedfea96fb9a07ef06f761e#heading-0",target:"_blank",rel:"noopener noreferrer"}},[s._v("后台管理项目总结"),n("OutboundLink")],1),s._v("提到的前端自行请求一个配置文件，动态修改你的相关配置。")]),s._v(" "),n("ul",[n("li",[s._v("静态文件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// config.json\n{\n  "api": "test.com"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("请求文件")])]),s._v(" "),n("p",[s._v("在项目"),n("code",[s._v("store")]),s._v("中请求你的配置文件，写入"),n("code",[s._v("state")]),s._v("中，在调用的时候可以全局访问到你的配置")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// api.js\nGetConfigApi() {\n  return new Promise((resolve, reject) => {\n    axios\n      .get(`/config.json?v=${new Date().getTime()}`)\n      .then(result => {\n        const configApi = {\n          API: result.data['api'], // 统一接口\n        };\n        resolve(configApi);\n      })\n      .catch(error => {\n        reject(error);\n      });\n  });\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h2",{attrs:{id:"nginx部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx部署"}},[s._v("#")]),s._v(" nginx部署")]),s._v(" "),n("p",[s._v("因为"),n("code",[s._v("vue-router")]),s._v("有"),n("code",[s._v("hash")]),s._v("和"),n("code",[s._v("history")]),s._v("不同的两种模式，使用不同的模式，"),n("code",[s._v("nginx")]),s._v("的配置不同，"),n("code",[s._v("hash")]),s._v("模式下，不需要改动，只需要部署你的前端文件就可以了，所以这里只讨论"),n("code",[s._v("history")]),s._v("模式下"),n("code",[s._v(".conf")]),s._v("文件的修改")]),s._v(" "),n("p",[s._v("访问修改"),n("code",[s._v("nginx")]),s._v("配置文件"),n("code",[s._v("nginx.conf")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n  listen  80;\n  server_name  test.com;\n\n  location / {\n    root  /front; // 前端文件路径\n    index  index.html; // hash模式只配置访问html就可以了\n    try_files $uri $uri/ /index.html; // history模式下\n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("修改完成，重启服务访问"),n("code",[s._v("test.com")])]),s._v(" "),n("h2",{attrs:{id:"部署到子级目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署到子级目录"}},[s._v("#")]),s._v(" 部署到子级目录")]),s._v(" "),n("p",[s._v("当我们需要把项目部署到子级目录下时，则需要修改项目的"),n("code",[s._v("BASE_URL")]),s._v("，生成一个子级目录下的绝对访问路径。修改对应的"),n("code",[s._v(".conf")]),s._v("配置文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n  listen  80;\n  server_name  test.com;\n\n  location /demo { // 子级目录\n    alias  /front/demo;\n    index  index.html;\n    try_files $uri $uri/ /demo/index.html; \n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("修改完成，重启服务访问"),n("code",[s._v("test.com/demo")])]),s._v(" "),n("h2",{attrs:{id:"缓存处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缓存处理"}},[s._v("#")]),s._v(" 缓存处理")]),s._v(" "),n("p",[s._v("前端项目的静态文件常常会被浏览器缓存，而项目编译后，"),n("code",[s._v("js")]),s._v("，"),n("code",[s._v("css")]),s._v("，图片等实际上是已经有"),n("code",[s._v("hash")]),s._v("值来去除了缓存，但是项目更新后，仍然会出现缓存问题，这是由于我们的项目整个入口都是在"),n("code",[s._v("index.html")]),s._v("文件上，浏览器实际是缓存了我们的"),n("code",[s._v("html")]),s._v("页面，所以我们要在"),n("code",[s._v("nginx")]),s._v("中告诉浏览器，"),n("code",[s._v("html")]),s._v("文件不被缓存。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("  location /demo {\n    add_header Cache-Control 'private, no-store, max-age=0';\n    ...\n  }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("p",[s._v("这里只讨论了"),n("code",[s._v("nginx")]),s._v("相关的部署，实际上"),n("code",[s._v("vue-router")]),n("a",{attrs:{href:"https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),n("OutboundLink")],1),s._v("上是有相关的配置例子的。")]),s._v(" "),n("p",[s._v("其他总结文章：")]),s._v(" "),n("ul",[n("li",[n("router-link",{attrs:{to:"/Note/webpack/webpack.html"}},[s._v("webpack常规打包优化方案")])],1),s._v(" "),n("li",[n("router-link",{attrs:{to:"/Note/vue/props.html"}},[s._v("组件通信处理方案")])],1),s._v(" "),n("li",[n("router-link",{attrs:{to:"/Note/vue/http.html"}},[s._v("后台管理项目总结")])],1)])])}),[],!1,null,null,null);e.default=t.exports}}]);